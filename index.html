<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orbit Visualization Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <div class="site-name">Orbit Plotter</div>
    <nav>
      <a href="index.html">Plotting</a>
      <a href="learning.html">Learning</a>
      <a href="resources.html">Resources</a>
    </nav>
  </header>

  <main class="layout">
    <div class="left-column">
      <div class="type">
        <h3>Type of Orbit</h3>
        <select id="orbitType" name="orbitType">
          <option value="2body">2 Body</option>
          <option value="cr3bp">CR3BP</option>
          <option value="relativemotion">Relative Motion</option>
        </select>
      </div>

      <div class="inputs">
        <!-- Dynamic inputs will appear here -->
      </div>
    </div>

    <div class="center">
      <div class="main-plot">
        <div id="mainPlot"></div>
      </div>
    </div>

    <div class="right-column">
      <div class="conserved">
        <h3>Conserved Quantities</h3>
        <div id="conservedPlot"></div>
      </div>
      <div class="errors">
        <h3>Errors</h3>
        <div id="errorPlot"></div>
      </div>
    </div>
  </main>

  <footer>
    <p>Made By: Josh Taylor and Zack Fraser</p>
    <p>Contact Us: orbitplotter@gmail.com</p>
  </footer>

  <!-- ===== JS Libraries ===== -->
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
  <script src="Main_plot.js"></script>
  <script src="conserved.js"></script>
  <script src="errors.js"></script>

  <!-- ===== Dynamic Input Script ===== -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const orbitTypeSelect = document.getElementById("orbitType");
    const inputsDiv = document.querySelector(".inputs");

    const inputGroups = {
      "2body": {
        "stateVector": `
          <h3>Two-Body – State Vector</h3>
          <input type="text" name="xpos" placeholder="x-position (km)">
          <input type="text" name="ypos" placeholder="y-position (km)">
          <input type="text" name="zpos" placeholder="z-position (km)">
          <input type="text" name="xvel" placeholder="x-velocity (km/s)">
          <input type="text" name="yvel" placeholder="y-velocity (km/s)">
          <input type="text" name="zvel" placeholder="z-velocity (km/s)">
          <button type="submit">Run</button>
        `,
        "orbitalElements": `
          <h3>Two-Body – Orbital Elements</h3>
          <input type="text" name="a" placeholder="semi-major axis (km)">
          <input type="text" name="e" placeholder="eccentricity">
          <input type="text" name="i" placeholder="inclination (deg)">
          <input type="text" name="RANN" placeholder="RAAN (deg)">
          <input type="text" name="argp" placeholder="argument of periapsis (deg)">
          <input type="text" name="tf" placeholder="Final Time (s)">
          <button type="submit">Run</button>
        `
      },
      "cr3bp": `
        <h3>Inputs – CR3BP</h3>
        <input type="text" name="mu3b" placeholder="μ (mass ratio)">
        <input type="text" name="xpos" placeholder="x-position">
        <input type="text" name="ypos" placeholder="y-position">
        <input type="text" name="zpos" placeholder="z-position">
        <input type="text" name="xvel" placeholder="x-velocity">
        <input type="text" name="yvel" placeholder="y-velocity">
        <input type="text" name="zvel" placeholder="z-velocity">
        <input type="text" name="tf" placeholder="Final Time">
        <button type="submit">Run</button>
      `,
      "relativemotion": `
        <h3>Inputs – Relative Motion</h3>
        <input type="text" name="dr" placeholder="Δr (km)">
        <input type="text" name="dv" placeholder="Δv (km/s)">
        <input type="text" name="n" placeholder="Mean Motion (rad/s)">
        <input type="text" name="tf" placeholder="Final Time (s)">
        <button type="submit">Run</button>
      `
    };

    function updateInputs() {
      const selectedOrbit = orbitTypeSelect.value;
      inputsDiv.style.opacity = 0;
      setTimeout(() => {
        if (selectedOrbit === "2body") {
          // Add radio buttons for state vector vs orbital elements
          inputsDiv.innerHTML = `
            <div class="orbit-choice">
              <label><input type="radio" name="twoBodyInput" value="stateVector" checked> State Vector</label>
              <label><input type="radio" name="twoBodyInput" value="orbitalElements"> Orbital Elements</label>
            </div>
            <div class="orbit-fields"></div>
          `;

          const fieldsDiv = inputsDiv.querySelector(".orbit-fields");
          fieldsDiv.innerHTML = inputGroups["2body"]["stateVector"];

          // Radio button listener
          const radios = inputsDiv.querySelectorAll('input[name="twoBodyInput"]');
          radios.forEach(radio => {
            radio.addEventListener("change", (e) => {
              fieldsDiv.innerHTML = inputGroups["2body"][e.target.value];

              const btn = fieldsDiv.querySelector("button");
              if (btn) {
                btn.addEventListener("click", (ev) => {
                  ev.preventDefault();
                  simulateOrbit();
                });
              }
            });
          });
        } else {
          inputsDiv.innerHTML = inputGroups[selectedOrbit];
        }

        const btn = inputsDiv.querySelector("button");
        if (btn) {
          btn.addEventListener("click", (e) => {
            e.preventDefault();
            simulateOrbit();
          });
        }

        inputsDiv.style.opacity = 1;

        if (window.Plotly?.Plots?.resize) {
          Plotly.Plots.resize(document.getElementById('mainPlot'));
        }
      }, 200);
    }

    orbitTypeSelect.addEventListener("change", updateInputs);
    updateInputs();

    window.addEventListener('resize', () => {
      if (window.Plotly?.Plots?.resize) {
        Plotly.Plots.resize(document.getElementById('mainPlot'));
      }
    });
  });
  </script>
</body>
</html>
